<!doctype html>

<link rel="shortcut icon" href="#" />

<html>
  <style>
    #instructions {
      color: #FFFFFF;
      width: 70%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 200px;
      margin-bottom: auto;
      text-align: center;
    }
    #thankyou {
      color: #FFFFFF;
      width: 70%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 200px;
      margin-bottom: auto;
      text-align: center;
    }
    #RoundNumDiv {
      color: #FFFFFF;
      width: 70%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 20px;
      margin-bottom: auto;
      text-align: center;
    }
    #main_image {
      /* width: 10%; */
      margin-left: auto;
      margin-right: auto;
      margin-top: 50px;
      margin-bottom: auto;
    }
    #main_image img {
      margin-left: auto;
      margin-right: auto;
      display: block;
      border-style: solid;
      border-color: rgb(128, 0, 0);
    }
    #main_image #intertitle {
      color: #FFFFFF;
      width: 70%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 100px;
      margin-bottom: auto;
      text-align: center;
    }
    #buttons {
      margin-left: auto;
      margin-right: auto;
      margin-top: 20px;
      margin-bottom: auto;
      overflow: hidden;
    }
    #exit_survey {
      color: #FFFFFF;
      width: 70%;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: auto;
      text-align: center;
    }
    </style>
    
  <head>
    <title> Sketch Matching </title>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/snap.svg-min.js"></script>
    <script src="js/jspsych.js"></script>
    <script src="js/jspsych-nAFC-circle.js"></script>
    <script src="js/jspsych-instructions.js"></script>
    <script src="js/lodash.min.js"></script>
    <!-- <script src="js/object_list.js"></script> -->
    <script src="js/setup.js"></script>
    <link rel="stylesheet" href="./custom.css"></link>
    

    <script>
      // make sure we have lodash; if we don't, then import it
      var has_require = typeof require !== 'undefined';
      if( typeof _ === 'undefined' ) {
        if( has_require ) {
          _ = require('lodash');
          utils  = require(__base + 'utils/sharedUtils.js');
        }
        else throw 'mymodule requires underscore, see http://underscorejs.org';
      };

      function sendData() {
        console.log('sending data to mturk');
        jsPsych.turk.submitToTurk({'score':score});
      };
      
      window.onbeforeunload = function() {
        return "Data will be lost if you leave the page, are you sure?";
      };

    </script>
  </head>


  <body>
    <div id="display-area"></div>
<div> OKAY</div>
    <!-- Instructions DIV is hidden once they 
    click the button. Default instruction text is for number condition -->
    <div id="instructions">
      <p id="instruction_text">
        <!-- You will see a series of numerals.
        Please click all the features that you think each numeral has! -->
        <center>
        <input id="raterName" placeholder="Name"></input>
        <input id="partitionNum" placeholder="Partition"></input>
      </center>
      </p>
      <button id="enterRaterInfo">
        submit
      </button>

      <button id="startExperimentButton"  style="display:none;">
        Click here to begin
      </button>
      <center>
      <button id="continueButton" style="display:none;">
        Click to continue
      </button>
    </center>
    </div>

    <div id="main_image">
      <img id="stim"
      width="480" height="240" alt="Image"/>
      
      <!-- when people's internet crashes, we don't want them in the dark! -->
      <img id="error_stim" src="/classify_iternum/forms/images/no_image.png"
      width="240" height="240" alt="Error_Stim"/>

    </div>


    <div id="buttons">
      <center>
      <div id="explanationDiv" style="color:white;height:100px;width:480px">



      </div>
    </center>
      <center>
        <div class="buttonDiv" id="catch1Div" style="margin-top:80px;height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;"><b style="color:orange">Matching</b><br>
        <img id="catch1" class="classifier_button" src="forms/images/classifier_buttons/catch1_button.png"
        width="60" height="60" style="background-color:#FFFFFF;" background="#FFFFFF" alt="Matching"/>
        <img id="catch1_ann" class="classifier_button" src="forms/images/classifier_buttons/catch1_button_ann.png"
        width="60" height="60" background="#FFFFFF" alt="Matching" style="background-color:#FFFFFF;display:none;"/>
        </div>

        <div class="buttonDiv" id="catch2Div" style="height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;"><b style="color:red">Grouping</b><br>
        <img id="catch2" class="classifier_button" src="forms/images/classifier_buttons/catch2_button.png"
        width="60" height="60" style="background-color:#FFFFFF;" background="#FFFFFF" alt="Grouping"/>
        <img id="catch2_ann" class="classifier_button" src="forms/images/classifier_buttons/catch2_button_ann.png"
        width="60" height="60" background="#FFFFFF" alt="Grouping" style="background-color:#FFFFFF;display:none;"/>
        </div>

        <div class="buttonDiv" id="catch3Div" style="height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;"><b style="color:white">Clipped</b><br>
        <img id="catch3" class="classifier_button" src="forms/images/classifier_buttons/catch3_button.png"
        width="60" height="60" style="background-color:#FFFFFF;" background="#FFFFFF" alt="Clipped"/>
        <img id="catch3_ann" class="classifier_button" src="forms/images/classifier_buttons/catch3_button_ann.png"
        width="60" height="60" background="#FFFFFF" alt="Clipped" style="background-color:#FFFFFF;display:none;"/>
        </div>
        
        <div class="buttonDiv" id="catch4Div" style="height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;"><b style="color:pink">Numbers</b><br>
        <img id="catch4" class="classifier_button" src="forms/images/classifier_buttons/catch4_button.png"
        width="60" height="60" style="background-color:#FFFFFF;" background="#FFFFFF" alt="Number"/>
        <img id="catch4_ann" class="classifier_button" src="forms/images/classifier_buttons/catch4_button_ann.png"
        width="60" height="60" background="#FFFFFF" alt="Number" style="background-color:#FFFFFF;display:none;"/>
        </div>

        <div class="buttonDiv" id="catch5Div" style="height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;"> <b style="color:magenta">Unique</b><br>
        <img id="catch5" class="classifier_button" src="forms/images/classifier_buttons/catch5_button.png"
        width="60" height="60" style="background-color:#FFFFFF;" background="#FFFFFF" alt="Unique"/>
        <img id="catch5_ann" class="classifier_button" src="forms/images/classifier_buttons/catch5_button_ann.png"
        width="60" height="60" background="#FFFFFF" alt="Unique" style="background-color:#FFFFFF;display:none;"/>
        </div>
        
        
      </center>
    </div>
<div style="display: flex;justify-content: center;height:80px">
<button id="NextButton" style="padding-top:10px;margin-top:20px;width:100px;height:50px;background-color:black;color:white;border-style:none;"> </button>  
</div>
    <div id="RoundNumDiv">
      <p id="RoundNumText">
        Round 1
      </p>
    </div>

    <div id="thankyou">
      <p id="thankyouText">
        Thank you!
      </p>
    </div>

    <div id="exit_survey" style="display:none">
      <br><p> Thanks for participating! Please fill out this optional demographic survey and submit your HIT at the bottom of the page. </p><br>
      (When you click "Submit HIT", a pop-up window will appear; feel free to click "Leave" at that prompt) <br>
      <p> What is your gender? </p>
      <select onChange="dropdownTip('gender::' + this.value)">
        <option value =""></option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
      </select>
      <br><br>

      <p> What is your age? </p>
      <textarea id='age' onChange="dropdownTip('age::' + this.value)" rows="1" cols="8"></textarea>
      <br><br>

      <p> Did you read the instructions and do you think you did the
  HIT correctly? </p>
      <select onChange="dropdownTip('confused::' + this.value)">
        <option value = ""></option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="confused">I was confused</option>
      </select>

      <p> Do you have any comments on the experiment? </p>
      <textarea id='comments' onChange="dropdownTip('comments::' + this.value)" rows="4" cols="50"></textarea>
      <br>

      <p> Note: Clicking this button should automatically submit the HIT and close this tab. There is no need to input a code.<p>
      <p> If you experience a problem submitting, please contact ladlab.ucsd@gmail.com for compensation. </p>

      <div><button id="surveySubmit" onclick="dropdownTip('submit')" type="button">Submit HIT</button></div>
    </div>
  
    <script>
      var turkerStatus = false;
      var curTrial = 0; /* we want to use this as 
          index into trialList, so start at 0 */
      var curTrialTimeStarted = 0;
      var last_clicked = 'nothing';
      var tutorial = true;
      
      $("#main_image").hide();
      $("#intertitle").hide();
      $("#thankyou").hide();
      $("#RoundNumDiv").hide();
      $("#buttons").hide();
      $("#NextButton").hide();

      
      
      // We want to add some precautions in case people's internet crashes!
      // so below, if there's an error retrieving the stim, we hide everything
      // and show them an error message. They can wait til the internet works,
      // and click the error message when they're able to get back to the game
      // Consulted: https://stackoverflow.com/questions/92720/jquery-javascript-to-replace-broken-images
      $("#error_stim").hide();
      $("#stim").error(
        function(){
          $("#stim").hide();
          $("#error_stim").show();
          $("#cardinalities").hide();
          $("#animals").hide();
        });
      $("#error_stim").on("click", function(){
        $("#error_stim").hide();
        $("#stim").show();
        $("#stim").attr("src", meta[curTrial].sketch_url);
        if (condition == 'shape'){$("#animals").show()}
        if (condition == 'number'){$("#cardinalities").show()}
      });
      
      $("#surveySubmit").on("click", function(){
        $("#exit_survey").hide()
        $("#thankyouText").text( "Successfully submitted. \n (Close this tab any time)")
        $("#thankyou").show()
      });

      var subject_information = [];
      // This gets called when someone selects something in the menu during the exit survey...
      // collects data from drop-down menus and submits using not mmturkey, but JSPsych
      function dropdownTip(data){
        var commands = data.split('::');
        switch(commands[0]) {
        case 'gender' :
          subject_information = _.extend(subject_information,
                    {'gender' : commands[1]}); break;
        case 'age' :
          subject_information = _.extend(subject_information,
                    {'age' : commands[1]}); break;
        case 'comments' :
          subject_information = _.extend(subject_information,
                    {'comments' : commands[1]}); break;
        case 'confused' :
          subject_information = _.extend(subject_information,
                    {'confused' : commands[1]}); break;
        case 'submit' :
          subject_information = _.extend(subject_information,
                    {'comments' : $('#comments').val(),
                  'totalLength' : new Date() - startTime});
          console.log("data is...");
          console.log(subject_information);
          if(turkerStatus == true) {
            jsPsych.turk.submitToTurk(subject_information); // this seems like it works, while the line below does not...         
            // window.opener.turk.submit(subject_information, true);
            window.close();
          } else if (typeof(PROLIFIC_PID) != undefined){
            // if this is a Prolific study
            prolificSubmitTo = "https://app.prolific.co/submissions/complete?cc=" // basic submit URL
            ProlificCompletionCode = "14F36ECD" // add the completion code - manually specified after Prolific generates it for you via its own interface (while you set up the study)
            prolificSubmitTo = prolificSubmitTo + ProlificCompletionCode;
            window.open(prolificSubmitTo,"_self");
          } else {
            console.log("would have submitted the following :")
            console.log(subject_information);
          }
          break;
        }
      }

      var startTime = new Date()
      // very janky way of getting the results of setup game into the experiment without redoing the whole thing in JSPsych
      // not sure what 'setupGame()' this is calling, as it doesn't appear to be the one defined in setup.js
      window.onload = function() {
        // setupGame();
        // a little thing to replace the actual setupGame() function because I already wrote the whole experiment in this doc. Do better next time     
        var socket = io.connect();


        // this is for when WE are going through images and rating them, and want to keep track of who is doing what
        $("#enterRaterInfo").on("click",function(){
          if (document.getElementById("raterName").value != "" && document.getElementById("partitionNum").value != ""){
              console.log(document.getElementById("raterName").value,document.getElementById("partitionNum").value)
              socket.emit("startGame",[document.getElementById("raterName").value,document.getElementById("partitionNum").value]);
              $("#enterRaterInfo").hide();
              $("#startExperimentButton").show();
            };
        });

        // the following line is important for if the worker has already done the task and we have to redirect them
        // https://stackoverflow.com/questions/33321792/how-to-redirect-a-client-after-a-socket-io-event
        socket.on('redirect', function(destination) {
            window.location.href = destination;

            // attention: can we put in an alert here? People are currently redirected without explanation
          });
        
        socket.on('onConnected', function(d) {
          
          socket.removeListener('onConnected');
          turkerStatus = d.turker;
          var meta = d.meta;

          // could get URL parameters right here (use jsPsych to query URL for MTurk / Prolific params)
          // then save them here. So Prolific workerID
          // capture info from Prolific
          var queryString = window.location.search;
          var urlParams = new URLSearchParams(queryString);
          var prolificID = urlParams.get('PROLIFIC_PID')    // ID unique to the participant
          var studyID = urlParams.get('STUDY_ID')                // ID unique to the study
          var sessionID = urlParams.get('SESSION_ID')        // ID unique to the particular 

          
          catches = meta.filter(function(X) {    // extract catch trials
            return X.catch == true
          });
          meta = meta.filter(function(X) {    // and make another structure of the non-catch trials
            return X.catch == false
          });
          
          tutorials = catches.slice(5,11);
          catches = catches.slice(0,5);
          meta = _.shuffle(meta);    // shuffle all those real trials
          catches = _.shuffle(catches);    // shuffle the catch trials too, but not tutorial
          
          for (var j=0; j<catches.length; j++){ // now reinsert the catch trials into the real ones at regular intervals
            interval = Math.round(meta.length / catches.length)
            meta.splice(interval*j+interval, 0, catches[j]); // https://stackoverflow.com/questions/586182/how-to-insert-an-item-into-an-array-at-a-specific-index-javascript  
          };

          meta = tutorials.concat(meta); // now prepend the tutorial trials to the list

          var URLs = [];
          var origAnimals = [];
          var origCardinalities = [];
          var orig_gametrials = [];
          var catch_trial_val = [];

          for (var j=0; j<meta.length; j++) {
            URLs.push(meta[j].URL)
            origAnimals.push(meta[j].animal)
            origCardinalities.push(meta[j].cardinality)
            orig_gametrials.push(meta[j].origTrialNum)
            catch_trial_val.push(meta[j].catch)
          };
          console.log("Partition number: ",d.whole_structure.versionID);

          $("#instructions").show();

          function StartExperiment() {
            $("#instructions").hide();
            $("#RoundNumDiv").show();

            catchID = URLs[curTrial].split('/')[3].split('.')[0];
            if (catchID in tutorialBlurbs){
              tutorial = true;
              $("#explanationDiv").html(tutorialBlurbs[catchID]);
            } else{
              tutorial = false;
            }
            
            $("#stim").attr("src", URLs[curTrial]);
            document.getElementById("stim").style.backgroundColor = "#FFFFFF";
            $("#main_image").show();
            $("#buttons").show();
            $("#NextButton").show();
            startTime = new Date();
            curTrialTimeStarted = new Date();
            $('#RoundNumText').empty().append("Round\n" + (curTrial + 1) + " of " + meta.length);
          };
          $("#startExperimentButton").on("click", function(){
            StartExperiment();
          });

          function AdvanceSlide() {
            var curTime = new Date(); // for measuring RT
            var reaction_time = (curTime - curTrialTimeStarted) - 450; // for measuring RT; we have 450ms of delay, too

            // displaying the new sketch for them to rate, and all the buttons, and reset their colours
            $("#main_image").show();
            $("#buttons").show();
            $(".buttonDiv").css("background-color", "#222222");
            last_clicked = Object.values(selected);

            // now store the data depending on what trial we're at
            if (curTrial > -1 & curTrial < meta.length){ // this used to say "URL.length"
            // now create the data structure we want to store for this trial on mongodb:
              var output = {
                dbname : 'iterated_number',
                colname : 'iternum2_recog',
                iterationName : 'sandbox1', // sandbox accidentally has some early pilots in it, use sandbox1 for sandboxing. [sandbox, sandbox1, pilot1, pilot2, sebastian]
                // pilot1 still had the very thematic instructions and no tutorial
                // pilot2 had totally game-based instructions examples and a tutorial phase
                
                // first, info about the rating task
                recog_gameID : d.gameid,

                workerID: d.workerID,
                assignmentID: d.assignmentID,
                hitID: d.hitID,
                turkSubmitTO: d.turkSubmitTO,     // specific to MTurk (otherwise 'undefined')

                prolificID: prolificID,
                studyID: studyID,
                sessionID: sessionID,     // specific to Prolific (otherwise 'undefined')

                rating_trial_num : curTrial+1,
                rating : last_clicked, // which label did the rater select?
                RT : reaction_time,

                // next, info about the original conditions under which the sketch was produced
                animal : origAnimals[curTrial], 
                cardinality : origCardinalities[curTrial],
                origTrialNum : orig_gametrials[curTrial],
                sketch_url : URLs[curTrial],
                catch_trial : catch_trial_val[curTrial]};
              
              // now reset the selected options:
              selected = {
                '#catch1':0,
                '#catch2':0,
                '#catch3':0,
                '#catch4':0,
                '#catch5':0
              };
            

            } if (curTrial == meta.length - 1){
              console.log("The End")
              $("#main_image").hide();
              $("#cardinalities").hide();
              $("#animals").hide();
              $("#RoundNumDiv").hide();
              $("#intertitle").hide();
              $("#exit_survey").show();
              $("#NextButton").hide();
              $("#buttons").hide();
            };

            // send that data to mongo! By way of app1.js of course, it needs to get to the server first
            // socket.emit('currentData', output); // this 'emits' the current trial info onto socket where app1.js is listening for it    

            // replace the stim image with whatever is next in the list
            curTrial = curTrial + 1
            $('#RoundNumText').empty().append("Round\n" + (curTrial + 1) + " of " + meta.length);
            $("#stim").attr("src", URLs[curTrial]);
            document.getElementById("stim").style.backgroundColor = "#FFFFFF";

            catchID = URLs[curTrial].split('/')[3].split('.')[0];
            if (catchID in tutorialBlurbs){
              tutorial = true;
              $("#explanationDiv").html(tutorialBlurbs[catchID]);
            } else{
              tutorial = false;
            };
            
            curTrialTimeStarted = new Date(); // for measuring RT
          };

          tutorialBlurbs = {'catch6':"<b style='color:#579dff'>Practice (1 of 6)</b> <br> This person used matching to outline the top row and leftmost column of the animal set, and clipping by not drawing anything else. <br>Select both <b>matching</b> and <b>clipped</b> to proceed.",
          'catch7':"<b style='color:#579dff'>Practice (2 of 6)</b> <br> This person relied on grouping to depict only the upper portion of the animal set, and clipping by not drawing anything else. <br>Select <b>grouping</b> and <b>clipped</b> to proceed.",
          'catch8':"<b style='color:#579dff'>Practice (3 of 6)</b> <br> This person used both grouping (on the left) and matching (top-right) to depict only the upper portion of the animal set, and clipping by not drawing anything else. <br>Select <b>matching</b>, <b>grouping</b>, and <b>clipped</b> to proceed.",
          'catch9':"<b style='color:#579dff'>Practice (4 of 6)</b> <br> This person used the number 6 to describe each full column of the animal set, as well as matching to communicate the remaining, rightmost column. <br>Select <b>matching</b> and <b>numbers</b> to proceed.",
          'catch10':"<b style='color:#579dff'>Practice (5 of 6)</b> <br> This person used some other strategy to make their symbol. It is not clear how this symbol relates to the animal set, so we can call it unique. <br>Select <b>unique</b> to proceed.",
          'catch11':"<b style='color:#579dff'>Practice (6 of 6)</b> <br> This person used a combination of matching and grouping to depict every element of the animal set. <br>Select <b>matching</b> and <b>grouping</b> to proceed."};

          tutorialAnswers = {'catch6':[1,0,1,0,0],
          'catch7':[0,1,1,0,0],
          'catch8':[1,1,1,0,0],
          'catch9':[1,0,0,1,0],
          'catch10':[0,0,0,0,1],
          'catch11':[1,1,0,0,0]};

          button2div = {'#catch1':'#catch1Div',
          '#catch2':'#catch2Div',
          '#catch3':'#catch3Div',
          '#catch4':'#catch4Div',
          '#catch5':'#catch5Div'};

          selected = {
            '#catch1':0,  // 1-to-1
            '#catch2':0,  // grouping
            '#catch3':0,  // clipped
            '#catch4':0,  // Arabic
            '#catch5':0   // arbitrary
          };

          function RegisterClick(button){
            $("#NextButton").text("Next");
            $("#NextButton").css("background-color", "#525252");
            $("#NextButton").css("padding-top", "10px");
            if (selected[button.selector] == 0){
              $(button2div[button.selector]).css("background-color", "#579dff"); // some yellow: #ebc034
              // $(button2div[button.selector]).css("border-color", "#613510");
              selected[button.selector] = 1;
              
            } else {
              $(button2div[button.selector]).css("background-color", "#222222");
              // $(button2div[button.selector]).css("border-color", "#222222");
              selected[button.selector] = 0;
            };
          };


          // the following could be abbreviated using this block of code:
          // https://tekeye.uk/html/html-image-hover-effects-using-onmouseover
          $("#catch1Div").on("mouseover", function(){
            $("#catch1").hide()
            $("#catch1_ann").show()
            $("#explanationDiv").html("<b style='color:orange;'>Matching</b> <br> When <i>one</i> mark represents <i>one</i> object.");
          });
          $("#catch1Div").on("mouseout", function(){
            $("#catch1_ann").hide()
            $("#catch1").show()
            tutorial ? $("#explanationDiv").html(tutorialBlurbs[catchID]) : $("#explanationDiv").html("");});
          $("#catch2Div").on("mouseover", function(){
            $("#catch2").hide()
            $("#catch2_ann").show()
            $("#explanationDiv").html("<b style='color:red;'>Grouping</b> <br> When <i>one</i> mark represents <i>multiple</i> objects");
          });
          $("#catch2Div").on("mouseout", function(){
            $("#catch2_ann").hide()
            $("#catch2").show()
            tutorial ? $("#explanationDiv").html(tutorialBlurbs[catchID]) : $("#explanationDiv").html("");});
          $("#catch3Div").on("mouseover", function(){
            $("#catch3").hide()
            $("#catch3_ann").show()
            $("#explanationDiv").html("<b style='color:white;'>Clipped</b> <br> When marks on the page only represent <i>some but not all</i> of the objects.");
          $("#catch3Div").on("mouseout", function(){
            $("#catch3_ann").hide()
            $("#catch3").show()
            tutorial ? $("#explanationDiv").html(tutorialBlurbs[catchID]) : $("#explanationDiv").html("");});
          $("#catch4Div").on("mouseover", function(){
            $("#catch4").hide()
            $("#catch4_ann").show()
            $("#explanationDiv").html("<b style='color:pink;'>Numbers</b> <br> Anything made of 1, 2, 3, 4, 5, 6, 7, 8, 9, or 0.");});
          $("#catch4Div").on("mouseout", function(){
            $("#catch4_ann").hide()
            $("#catch4").show()
            tutorial ? $("#explanationDiv").html(tutorialBlurbs[catchID]) : $("#explanationDiv").html("");});
          $("#catch5Div").on("mouseover", function(){
            $("#catch5").hide()
            $("#catch5_ann").show()
            $("#explanationDiv").html("<b style='color:magenta;'>Unique</b> <br> Anything else!");});});
          $("#catch5Div").on("mouseout", function(){
            $("#catch5_ann").hide()
            $("#catch5").show()
            tutorial ? $("#explanationDiv").html(tutorialBlurbs[catchID]) : $("#explanationDiv").html("");});



          // is there some way of condensing the following blocks of code (the ones making all the buttons dynamic?)
          $("#catch1Div").on("click", function(){RegisterClick($("#catch1"))});
          $("#catch2Div").on("click", function(){RegisterClick($("#catch2"))});
          $("#catch3Div").on("click", function(){RegisterClick($("#catch3"))});
          $("#catch4Div").on("click", function(){RegisterClick($("#catch4"))});
          $("#catch5Div").on("click", function(){RegisterClick($("#catch5"))});

          $("#NextButton").on("click", function(){
            sum = Object.values(selected).reduce((a, b) => a + b, 0);

            if (tutorial == true && Object.values(selected).toString() == tutorialAnswers[catchID].toString()){  // they never equal unless you cast them as string or something... pretty annoying
              
              // if we've finished the tutorial, show an intertitle and let them proceed
              if (catchID == 'catch11'){
                $("#main_image").hide();
                $("#buttons").hide();
                $("#NextButton").hide();
                $("#RoundNumDiv").hide();
                $("#instruction_text").html("Great, you've finished the tutorial. Onto the real thing!");
                $("#startExperimentButton").attr("style","display:none;");
                $("#continueButton").attr("style","display:block;");
                $("#continueButton").on("click", function(){
                  tutorial = false;
                  $("#buttonDiv").attr("style","margin-top:0;height:100px;width:100px;background-color:#222222;display:inline-block;border-style:solid;");
                  $("#explanationDiv").attr("style","color:white;height:20px;width:480px");
                  $("#explanationDiv").html("");
                  $("#instructions").hide();
                  $("#NextButton").show();
                  $('#RoundNumDiv').show();
                  AdvanceSlide();
                });
                $("#instructions").show();
                
              } else {  // this handles correct answers on tutorial trials 
                $("#NextButton").text("");
                $("#NextButton").css("background-color", "black");
                $("#stim").attr("src", "forms/images/blank_stim.png");
                $("#NextButton").hide();
                setTimeout(function(){
                  $("#NextButton").show();
                  AdvanceSlide();
                }, 450);
              };
              
              
            } else if (tutorial == true && Object.values(selected).toString() != tutorialAnswers[catchID].toString()){  // this handles failed tutorial trials (unlimited attempts)
              $("#NextButton").text("Try Again");
              $("#NextButton").css("background-color", "red");
              $("#NextButton").css("padding-top", "5px");

            } else if (sum != 0){  // this handles correct answers on normal trials
              
              $("#NextButton").text("");
              $("#NextButton").css("background-color", "black");
              $("#stim").attr("src", "forms/images/blank_stim.png");
              $("#NextButton").hide();
              setTimeout(function(){
                $("#NextButton").show();
                AdvanceSlide();
              }, 450);
              
            } else if (sum == 0){  // this handles null answers on normal trials (unlimited attempts)
              $("#NextButton").text("Choose Something");
              $("#NextButton").css("background-color", "red");
              $("#NextButton").css("padding-top", "5px");
            };
          });
        });
      }
    </script>


  </body>
</html>
