<!DOCTYPE html>
<html>
  <head>
    <title> Numbers Game </title>

    <!-- Load style sheet -->
    <link href="/draw_number/lib/css/shared.css" media="screen" rel="stylesheet" type="text/css">
    <link href="custom.css" media="screen" rel="stylesheet" type="text/css">

    <!-- Notice the URL, this is handled by socket.io on the server automatically, via express -->
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>

    <!-- Include some extra functional programming tools -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"> </script> -->
    <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>

    <!-- Detect browser and zoom -->
    <script type="text/javascript" src="https://s3.amazonaws.com/dlcommon/js/browserdetect-0.0.1.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/dlcommon/js/detect-zoom-20120627.js"></script>

    <!-- Load jQuery, which lets us handle mouse events -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="/node_modules/paper/dist/paper-full.js"></script>
    <script type="text/javascript"> paper.install(window); </script>

    <!-- Load the common game code. -->
    <script type="text/javascript" src="game.core.js"></script>

    <!-- Finally, Load the game client code. -->
    <script type="text/javascript" src="../utils/clientBase.js"></script>
    <script type="text/javascript" src="game.client.js"></script>
    <script type="text/javascript" src="drawing.js"></script>
    
    <!-- Hoping this will let us actually submit to turk. -->
    <script src="../lib/js/jspsych.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /*body { font: 13px Helvetica, Arial; }*/
        #messages li { padding: 5px 10px; }
        /*#messages li:nth-child(odd) { background: #eee; }*/
    </style>

  </head>

  <body>
    <div id='header'>
        <h1 id='roleLabel'> You are the </h1>
        <p id='instructs'> </p>
        <p style="color:white" id='feedback'> </p>
        <p style="color:white" id='scoreupdate'> </p>
        <p style="color:white" id='turnIndicator'> </p>
        <!-- <p style="color:white" id='roundnumber'> Round 1 of 40 </p> -->
        <p style="color:white" id='roundnumber'> </p>
        <p style="color:white" id='score'> </p>
        <!-- <p style="color:white" id='bonuslabel'>Possible bonus </p>
        <p style="color:white" id='cents'>if correct (Â¢): </p> --> <!-- remove timer -->
        
        <!-- <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="100"
                 aria-valuemin="0" aria-valuemax="100">
            </div>
            <div class="value-bar">
                  <div class="value">MIN</div><div class="value">MID</div>
                  <div class="value">MAX</div>
            </div>
        </div> --> <!-- remove timer -->
        <div id="inklabel" style="display:none;">Remaining ink:
          <div class="ink">
            
            <div class="ink-bar" role="inkbar" aria-valuenow="100"
                 aria-valuemin="0" aria-valuemax="100">
            </div>
          </div>
        </div>
        

    </div>

    <div id='main' style="display:flex;">

      <span width="100%">
        <canvas id="viewport"> </canvas>

        <div id="channel" tabindex=1 height='60vh' width='200px' style="position: absolute;
        top: 40vh;
        right:0;left:0;
        float: bottom;
        margin: auto;">
        
          <div id="commonground" height='20vh' width='200px' style="margin:auto; padding-top:5px; overflow:visible; background-color: #b8c7f5; min-height: 60px; max-width: 60vh; display:block; align-items: center; justify-content: center; text-align: center; font-weight: bold; font-size: x-large; border-style:solid; border-width: 4px; border-color:navy;">  </div>

        </div>
        
      <canvas id="sketchpad" tabindex=1 height='500px' width='500px' style="display:none;"></canvas>

      
        
      <div id="buttons" style="width: 60vh; height:18vh; bottom:0px; float: bottom; position:absolute; background-color: white; align-items: center; justify-content: center; color:black; left: 50%; transform: translate(-50%, -50%);">

        <button id="startbutton" style="display:none">Your receiver is here. <br>Click to begin writing!</button>
        <div id="buttons_instructions" style="display:none"> Symbol Keyboard </div><br>
        
      <div id="numberButtons" margin='auto'>
        <button class="clickable" id="button1" style="width:12vh; height: 12vh; top:2vh;  margin-left:0px; margin-bottom:0px; background-color:black;"  onclick="writeNumber(curNum,1)">
        <img src="buttons/1.png" style="width: 10vh; height: 10vh;" /></button>
        
        <button class="clickable" id="button2" style="width:12vh; height: 12vh; top:2vh;  margin-left:0px; margin-bottom:0px; background-color:black;" onclick="writeNumber(curNum,2)">
        <img src="buttons/2.png" style="width: 10vh; height: 10vh;" /></button>
        
        <button class="clickable" id="button3" style="width:12vh; height: 12vh; top:2vh;  margin-left:0px; margin-bottom:0px; background-color:black;" onclick="writeNumber(curNum,3)">
        <img src="buttons/3.png" style="width: 10vh; height: 10vh;" /></button>
        
        <button class="clickable" id="button4" style="width:12vh; height: 12vh; top:2vh;  margin-left:0px; margin-bottom:0px; background-color:black;" onclick="writeNumber(curNum,4)">
        <img src="buttons/4.png" style="width: 10vh; height: 10vh;" /></button>

        <button class="clickable" id="deletebutton" style="width:8vh; height: 4vh; top:4vh;  background-color:slategrey;" onclick="deleteNumber()"> Delete </button>

      </div>
      </div>

      <div id='loading' style="display: none"><div id="loading-message">The Sketcher is still drawing...</div></div>
      <div id='occluder' style="display: none"> </div>
      <button id="submitbutton" style="display:none">Submit</button>
      <button id="confirmbutton" style="display:none">Confirm</button>
    </div>

    <div id="dimScreen" style="display:none"></div>

    <div id="after_pre" style="display:none">
      <span>
      	<div id="after_pre_text">
      	  <p>Great job! By now, you have made drawings of objects from both the red set and the blue set.</p>
      	  <br />
      	  <p>For the next several trials, you will be repeatedly drawing objects from only one of these sets!</p>
      	  <br />
      	  <p>Ready to begin?</p>
      	  <button id="after_pre_button" style="width:100px; height:50px;font-size:150%;margin: 20px"> Next </button>
      	</div>
      <!-- <p id="after_pre_instruction"></p> -->
    </div>

    <div id="before_post" style="display:none">
      <span>
        <div id="before_post_text">
      	  <p>Great job! You have been seeing only one of the two sets in the past several trials.</p>
      	  <br />
      	  <p>For the final few trials, you are going to see both of the two sets!</p>
      	  <br />
      	  <p>Ready to begin?</p>
      	  <button id="before_post_button" style="width:100px; height:50px;font-size:100%;margin: 20px"> Next </button>
      	</div>
      <!-- <p id="before_post_instruction"></p> -->
    </div>



    <div id="exit_survey" style="display:none">
      <br><br><br>
      <p> Did you believe you were playing against another human player? </p>
      <select onChange="dropdownTip('human::' + this.value)">
      <option value=""></option>
      <option value="yes">Yes, I thought they were a human</option>
      <option value="no">No, I thought it was a computer program</option>
      </select>
      <p id='humanResult' style="display:none;color:red"> Thank you for your response -- in fact, all players were paired with other human turkers! <p>

  <br> <br>
      <p> What is your gender? </p>
      <select onChange="dropdownTip('gender::' + this.value)">
        <option value =""></option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
      </select>
      <br><br>

      <p> What is your age? </p>
      <textarea id='age' onChange="dropdownTip('age::' + this.value)" rows="1" cols="8"></textarea>
      <br><br>


      <p> Did you read the instructions and do you think you did the
  HIT correctly? </p>
      <select onChange="dropdownTip('confused::' + this.value)">
        <option value = ""></option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="confused">I was confused</option>
      </select>

      <br><br>
      <p> How much did you like working with your partner? </p>
      <select onChange="dropdownTip('partner::' + this.value)">
        <option value = ""></option>
        <option value="not much">Not that much</option>
        <option value="okay">My partner was fine</option>
        <option value="liked">I liked working with my partner</option>
        <option value="loved">I really enjoyed working with my partner</option>
      </select>
      <br><br>

      <p> Do you have any comments on the experiment? </p>
      <textarea id='comments' rows="4" cols="50"></textarea>
      <br>

      <p> Note: Clicking this button should automatically submit the HIT and close this tab. There is no need to input a code.<p>
      <p> If you experience a problem submitting, please contact ladlab.ucsd@gmail.com for compensation. </p>

      <div><button id="surveySubmit" onclick="dropdownTip('submit')" type="button">Submit HIT</button></div>
    </div>
  </body>

  
  <script>
    // want to write a function for people to click buttons and create their numerals
    curNum = 1;
    curMessage = [];  // will be a sequence of numbers (1-4) corresponding to each image in the message
    curProcess = []; // the Sender's entire process of writing. Includes timestamps as keys, and actions as values



    writeNumber = function(currentNum,cardinality){
      if (globalGame.drawingAllowed == true && currentNum < 31){  // maximum of 27 images
        imageSignID = 'image' + currentNum.toString();
        curMessage.push(cardinality);
        curProcess.push([Date.now(),cardinality].join(':'));
        globalGame.currStrokeNum += 1;
        if (curNum == 1){
          $('#commonground').html("");
        };

        // // auto expand width of commonground channel if too many tokens
        // if (curNum*50 > 250){
        //   // leftPos = $('#commonground').scrollLeft();
        //   // $('#commonground').animate({scrollLeft: leftPos + 200},0);
        //   if(curNum*50 < 700){
        //     newWidth = (parseInt($( "#commonground" ).css( "max-width").split('p')[0]) + 50 ).toString() + "px"
        //   $("#commonground" ).css( "max-width",newWidth);
        //   };
        // }
        if (currentNum == 30){
          $("#buttons_instructions").html("<p> You've hit the maximum number of symbols! </p>");
        };

        // display the new image
        $('#commonground').append("<img id='" +imageSignID+ "' class='imageSign' src='buttons/"+cardinality.toString()+ ".png" + "' width='35vh' height='35vh' margin='auto'/>");
        curNum += 1;
      };
    };

    deleteNumber = function(){
      if (globalGame.drawingAllowed == true){
        if(curNum > 1){
          curNum = curNum - 1;
          globalGame.currStrokeNum -= 1;
          curMessage.pop();
          curProcess.push([Date.now(),'del'].join(':'))
          document.getElementById('image' + (curNum).toString()).remove();
          if (curNum == 1){
            $('#commonground').html("Your message goes here.");
          };

          if (curNum == 30){
            $("#buttons_instructions").html("Symbol Keyboard");
          };
        
        //   // auto decrease width of commonground channel if too many tokens
        // if (parseInt($( "#commonground" ).css( "height").split('p')[0]) < 101 && parseInt($( "#commonground" ).css( "max-width").split('p')[0]) > 250){
        //   newWidth = (parseInt($( "#commonground" ).css( "max-width").split('p')[0]) - 50 ).toString() + "px"
        //   $( "#commonground" ).css( "max-width",newWidth);
        // };
      };

      };
      
    };

    $("#submitbutton").on('click',function(){
      if (globalGame.currStrokeNum > 0){
        globalGame.curMessage = curMessage;
        globalGame.curProcess = curProcess;
      };
    });    
    

    document.addEventListener("keyup", function(event) {
      if(curNum > 1 && (event.keyCode === 46 || event.keyCode === 8)){
        deleteNumber();
      }
    });


    // what OS are people using?
    // https://stackoverflow.com/questions/38241480/detect-macos-ios-windows-android-and-linux-os-with-js
    function getOS() {
      var userAgent = window.navigator.userAgent,
          platform = window.navigator.platform,
          macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],
          windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'],
          iosPlatforms = ['iPhone', 'iPad', 'iPod'],
          os = null;

      if (macosPlatforms.indexOf(platform) !== -1) {
        os = 'Mac OS';
      } else if (iosPlatforms.indexOf(platform) !== -1) {
        os = 'iOS';
      } else if (windowsPlatforms.indexOf(platform) !== -1) {
        os = 'Windows';
      } else if (/Android/.test(userAgent)) {
        os = 'Android';
      } else if (!os && /Linux/.test(platform)) {
        os = 'Linux';
      }

      return os;
    };
    var OS = getOS();
  </script>
</html>
